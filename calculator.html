<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Smart Home Calculator</title>
<style>
  body { font-family: Arial, sans-serif; background: #f4f6f9; margin:0; }
  .container { max-width: 1200px; margin: 0 auto; padding: 40px; }
  .calc-form { background: #fff; padding: 30px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
  .calc-form h2 { margin-top:0; text-align:center; }
  .calc-step { margin-bottom:20px; }
  select,input[type=radio],input[readonly] { width:100%; padding:10px; margin-top:5px; font-size:16px; }
  input[readonly] { background:#f1f5f9; border:1px solid #cbd5e1; }
  .summary-card { background:#fff; padding:20px; border-radius:12px; box-shadow:0 2px 10px rgba(0,0,0,0.05); margin-top:30px; }
  .summary-card h3 { margin-top:0; }
  ul { margin:5px 0 0 20px; }
  button { padding:12px 20px; border:none; border-radius:8px; background:#2563eb; color:#fff; cursor:pointer; font-size:16px; margin-top:20px; width:100%; }
  button:hover { background:#1e40af; }
</style>
</head>
<body>

<div class="container">
  <div class="calc-form">
    <h2>Smart Home Security Calculator</h2>

    <!-- Lead Info Display (Readonly) -->
    <div class="calc-step">
      <label>First Name</label>
      <input type="text" id="calc-firstname" readonly />
    </div>
    <div class="calc-step">
      <label>Last Name</label>
      <input type="text" id="calc-lastname" readonly />
    </div>
    <div class="calc-step">
      <label>Email</label>
      <input type="email" id="calc-email" readonly />
    </div>
    <div class="calc-step">
      <label>Phone</label>
      <input type="tel" id="calc-phone" readonly />
    </div>
    <div class="calc-step">
      <label>Address</label>
      <input type="text" id="calc-address" readonly />
    </div>

    <!-- Calculator Inputs -->
    <div class="calc-step">
      <label>Home Size</label>
      <select id="homeSize">
        <option value="under1000">&lt; 1,000 sq ft</option>
        <option value="1000_1999">1,000–1,999 sq ft</option>
        <option value="2000_2999">2,000–2,999 sq ft</option>
        <option value="3000_3999">3,000–3,999 sq ft</option>
        <option value="4000plus">4,000+ sq ft</option>
      </select>
    </div>

    <div class="calc-step">
      <label>Project Level</label>
      <label><input type="radio" name="complexity" value="basic" checked> Starter</label>
      <label><input type="radio" name="complexity" value="standard"> Standard</label>
      <label><input type="radio" name="complexity" value="premium"> Premium</label>
    </div>

    <div class="calc-step">
      <label>Installation</label>
      <select id="installType">
        <option value="diy">DIY Install</option>
        <option value="pro">Professional Install</option>
      </select>
    </div>

    <!-- Estimate Summary Card -->
    <div class="summary-card">
      <h3>Your Estimate</h3>
      <p>Equipment + Install: <span id="summaryTotal">$0</span></p>
      <p>Monitoring: <span id="summaryMonitoring">$0/mo</span></p>
      <p>Included Devices:</p>
      <ul id="summaryBullets"></ul>
      <p>Estimated Risk Score: <span id="riskScoreDisplay">--</span></p>
    </div>

    <button id="btnResults">View Full Recommendations</button>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function(){

  // ------------------------------
  // Load lead data from sessionStorage (HubSpot form submission)
  // ------------------------------
  const leadData = JSON.parse(sessionStorage.getItem("lead_data") || "{}");

  const readonlyFields = ["firstname","lastname","email","phone","address"];
  readonlyFields.forEach(f => {
    const el = document.getElementById("calc-" + f);
    if(el) el.value = leadData[f] || "";
  });

  // ------------------------------
  // Calculator Setup
  // ------------------------------
  const homeSizeEl = document.getElementById("homeSize");
  const installTypeEl = document.getElementById("installType");
  const complexityEls = document.querySelectorAll('input[name="complexity"]');

  const summaryTotalEl = document.getElementById("summaryTotal");
  const summaryMonitoringEl = document.getElementById("summaryMonitoring");
  const summaryBulletsEl = document.getElementById("summaryBullets");
  const riskScoreDisplayEl = document.getElementById("riskScoreDisplay");

  const equipmentPrices = {
    under1000:{basic:300, standard:500, premium:800},
    "1000_1999":{basic:500, standard:900, premium:1500},
    "2000_2999":{basic:800, standard:1500, premium:2500},
    "3000_3999":{basic:1200, standard:2200, premium:3500},
    "4000plus":{basic:2000, standard:3500, premium:5000}
  };
  const installMultipliers = { diy:1, pro:1.25 };
  const monitoringPrices = { basic:25, standard:50, premium:75 };
  const deviceList = {
    basic:["2–3 Security Cameras","1 Video Doorbell","2–3 Entry Sensors","Smart Lock (1)","Basic Alarm Panel"],
    standard:["4–6 Security Cameras","Video Doorbell","4–6 Entry Sensors","Smart Lock(s)","Smart Thermostat","Smart Lighting (3–5 zones)","Smart Alarm System"],
    premium:["6+ Security Cameras","Video Doorbell + Chimes","Full Entry Sensor Coverage","Whole-Home Smart Locks","Smart Thermostats","Full Lighting Automation","Advanced Alarm System","Voice Assistant Integration","Custom Automation Scenes"]
  };

  function getComplexity(){ return Array.from(complexityEls).find(r=>r.checked).value; }

  function calculateRiskScore(){
    let score = 50;
    const homeSize = homeSizeEl.value;
    const complexity = getComplexity();
    const installType = installTypeEl.value;

    if(homeSize=="under1000") score +=5;
    else if(homeSize=="1000_1999") score +=10;
    else if(homeSize=="2000_2999") score +=20;
    else if(homeSize=="3000_3999") score +=30;
    else score +=40;

    if(complexity=="standard") score +=10;
    else if(complexity=="premium") score +=20;

    if(installType=="pro") score -=5;

    return Math.min(100, Math.max(0, Math.round(score)));
  }

  function updateEstimate(){
    const homeSize = homeSizeEl.value;
    const complexity = getComplexity();
    const installType = installTypeEl.value;

    const total = equipmentPrices[homeSize][complexity] * installMultipliers[installType];
    const monitor = monitoringPrices[complexity];

    summaryTotalEl.textContent = "$"+Math.round(total).toLocaleString();
    summaryMonitoringEl.textContent = "$"+monitor+"/mo";

    summaryBulletsEl.innerHTML = "";
    deviceList[complexity].forEach(d=>{
      const li = document.createElement("li");
      li.textContent = d;
      summaryBulletsEl.appendChild(li);
    });

    riskScoreDisplayEl.textContent = calculateRiskScore();
  }

  [homeSizeEl, installTypeEl, ...complexityEls].forEach(el=>el.addEventListener("change", updateEstimate));
  updateEstimate();

  // ------------------------------
  // Redirect to results page
  // ------------------------------
  document.getElementById("btnResults").addEventListener("click", function(){
    const resultsData = {
      ...leadData,
      homeSize: homeSizeEl.value,
      complexity: getComplexity(),
      installType: installTypeEl.value,
      riskScore: calculateRiskScore(),
      equipment: Math.round(equipmentPrices[homeSizeEl.value][getComplexity()] * installMultipliers[installTypeEl.value]),
      monitoring: monitoringPrices[getComplexity()],
      devices: deviceList[getComplexity()]
    };
    sessionStorage.setItem("calc_results", JSON.stringify(resultsData));
    window.location.href = "/results.html";
  });

});
</script>

</body>
</html>
