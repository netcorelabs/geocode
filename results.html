<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Smart Home Security Results</title>
<style>
  body { font-family: Arial, sans-serif; background: #f4f6f9; margin:0; }
  .container { max-width: 1200px; margin: 0 auto; padding: 40px; }
  .summary-card { background: #fff; padding: 30px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); margin-bottom: 30px; }
  h2, h3 { margin-top: 0; }
  ul { margin: 10px 0 0 20px; }
  #map { width: 100%; height: 400px; border-radius: 12px; margin-top: 20px; }
  .info { margin-top: 10px; font-size: 16px; }
  .status { margin-top: 20px; font-weight: bold; color: green; }
</style>
</head>
<body>

<div class="container">
  <div class="summary-card">
    <h2>Your Smart Home Estimate</h2>
    <p><strong>Name:</strong> <span id="leadName">--</span></p>
    <p><strong>Email:</strong> <span id="leadEmail">--</span></p>
    <p><strong>Address:</strong> <span id="leadAddress">--</span></p>
    <p><strong>Estimated Risk Score:</strong> <span id="riskScore">--</span></p>

    <h3>Equipment + Install</h3>
    <p><strong>Total:</strong> <span id="summaryTotal">$0</span></p>
    <p><strong>Monitoring:</strong> <span id="summaryMonitoring">$0/mo</span></p>

    <h3>Included Devices</h3>
    <ul id="summaryBullets"></ul>

    <p class="status" id="submissionStatus">Sending your data to HubSpot...</p>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", async function () {

  // ------------------------------
  // Retrieve calculator + lead data
  // ------------------------------
  const resultsData = JSON.parse(sessionStorage.getItem("calc_results") || "{}");

  if(!resultsData.email){
    document.getElementById("submissionStatus").textContent = "Error: No lead data found. Please go back and submit your information.";
    return;
  }

  const { firstname, lastname, email, address, homeSize, complexity, installType, riskScore, equipment, monitoring, devices } = resultsData;

  document.getElementById("leadName").textContent = `${firstname} ${lastname}`;
  document.getElementById("leadEmail").textContent = email;
  document.getElementById("leadAddress").textContent = address;
  document.getElementById("riskScore").textContent = riskScore;

  const equipmentPrices = {
    under1000:{basic:300, standard:500, premium:800},
    "1000_1999":{basic:500, standard:900, premium:1500},
    "2000_2999":{basic:800, standard:1500, premium:2500},
    "3000_3999":{basic:1200, standard:2200, premium:3500},
    "4000plus":{basic:2000, standard:3500, premium:5000}
  };
  const installMultipliers = { diy:1, pro:1.25 };
  const monitoringPrices = { basic:25, standard:50, premium:75 };
  const deviceList = {
    basic:["2–3 Security Cameras","1 Video Doorbell","2–3 Entry Sensors","Smart Lock (1)","Basic Alarm Panel"],
    standard:["4–6 Security Cameras","Video Doorbell","4–6 Entry Sensors","Smart Lock(s)","Smart Thermostat","Smart Lighting (3–5 zones)","Smart Alarm System"],
    premium:["6+ Security Cameras","Video Doorbell + Chimes","Full Entry Sensor Coverage","Whole-Home Smart Locks","Smart Thermostats","Full Lighting Automation","Advanced Alarm System","Voice Assistant Integration","Custom Automation Scenes"]
  };

  // Display estimate
  const total = equipmentPrices[homeSize][complexity]*installMultipliers[installType];
  const monitor = monitoringPrices[complexity];

  document.getElementById("summaryTotal").textContent = `$${Math.round(total).toLocaleString()}`;
  document.getElementById("summaryMonitoring").textContent = `$${monitor}/mo`;

  const bulletsEl = document.getElementById("summaryBullets");
  bulletsEl.innerHTML = "";
  deviceList[complexity].forEach(d=>{
    const li = document.createElement("li");
    li.textContent = d;
    bulletsEl.appendChild(li);
  });

  // ------------------------------
  // Send data to HubSpot
  // ------------------------------
  try {
    const response = await fetch("https://hubspotgate.netlify.app/.netlify/functions/submit-lead", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        firstname, lastname, email, address,
        riskScore,
        systemSummary: `Home Size: ${homeSize}, Level: ${complexity}, Install: ${installType}`,
        equipment: total,
        install: Math.round(total - equipmentPrices[homeSize][complexity]), // rough install cost
        monitoring: monitor,
        devices: deviceList[complexity]
      })
    });

    const result = await response.json();

    if(response.ok){
      document.getElementById("submissionStatus").textContent = "✅ Your data was successfully sent to HubSpot!";
    } else {
      console.error(result);
      document.getElementById("submissionStatus").textContent = "⚠️ Failed to send data to HubSpot. Please contact support.";
    }
  } catch(err){
    console.error(err);
    document.getElementById("submissionStatus").textContent = "⚠️ Error sending data to HubSpot.";
  }

});
</script>

</body>
</html>
