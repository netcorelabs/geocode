<script>
document.addEventListener("DOMContentLoaded", function() {

  const address =
    new URLSearchParams(window.location.search).get("address") ||
    localStorage.getItem("lead_address") ||
    "Atlanta, GA";

  const riskScore =
    new URLSearchParams(window.location.search).get("riskScore") || 85;

  document.getElementById("riskScore").textContent = riskScore;

  function loadGoogleMaps() {

    const script = document.createElement("script");

    script.src =
      "https://maps.googleapis.com/maps/api/js?key={{ GOOGLE_MAPS_KEY }}&libraries=visualization,marker&callback=initMap";

    script.async = true;
    script.defer = true;

    document.head.appendChild(script);
  }

  window.initMap = function() {

    const geocoder = new google.maps.Geocoder();

    geocoder.geocode({ address: address }, function(results, status) {

      if (status !== "OK" || !results[0]) {
        console.error("Geocode failed:", status);
        return;
      }

      const loc = results[0].geometry.location;

      const map = new google.maps.Map(document.getElementById("map"), {
        zoom: 13,
        center: loc,
        mapId: "DEMO_MAP_ID"
      });

      new google.maps.marker.AdvancedMarkerElement({
        map,
        position: loc
      });

    });

  };

  loadGoogleMaps();

});
</script>
